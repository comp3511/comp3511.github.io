
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Shared Memory Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="socket.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Inter-process Communication</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="./">
            
                <a href="./">
            
                    
                    Inter-process Communication
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="2.1.1" data-path="shm.html">
            
                <a href="shm.html">
            
                    
                    Shared Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="socket.html">
            
                <a href="socket.html">
            
                    
                    Unix Socket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="msg-queue.html">
            
                <a href="msg-queue.html">
            
                    
                    Message Queue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="mmap.html">
            
                <a href="mmap.html">
            
                    
                    Memory Map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="task.html">
            
                <a href="task.html">
            
                    
                    Assignment One
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Multithreading</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../part-two/">
            
                <a href="../part-two/">
            
                    
                    Multithreading
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../part-two/pthread.html">
            
                <a href="../part-two/pthread.html">
            
                    
                    Introduction to Pthread
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../part-two/nitty_gritty.html">
            
                <a href="../part-two/nitty_gritty.html">
            
                    
                    Pthread In-depth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../part-two/safety.html">
            
                <a href="../part-two/safety.html">
            
                    
                    Thread Safety
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="../part-two/task.html">
            
                <a href="../part-two/task.html">
            
                    
                    Assignment Two
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Synchronization</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../part-three/">
            
                <a href="../part-three/">
            
                    
                    Synchronization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../part-three/mutex.html">
            
                <a href="../part-three/mutex.html">
            
                    
                    Mutex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../part-three/semaphore.html">
            
                <a href="../part-three/semaphore.html">
            
                    
                    Semaphore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../part-three/task.html">
            
                <a href="../part-three/task.html">
            
                    
                    Assignment Three
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../reference.html">
            
                <a href="../reference.html">
            
                    
                    Reference
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Shared Memory</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="shared-memory">Shared Memory</h1>
<h3 id="shmget"><code>shmget()</code></h3>
<p><strong>Shared Memory</strong> is a chunk of memory space that is purposefully allocated for processes to store
and use variables and data in a co-working environment. Each time we allocate a certain amount of memory space for sharing, we need to pass a numeric <code>key_t</code> variable as one of the argument to the <code>shmget()</code> system call, the role for <code>key_t</code> is act as a unique identifier for both processes (both forked and independent) to retreive the data from the shared memory, however if you wish to keep the allocated memory within your own program and its child process, you can specify <code>IPC_PRIVATE</code> to indicate such preference. </p>
<p><img src="../assets/shm-simple-diagram.png" alt="Shared Memory Simple Model"></p>
<p>Another argument to pass to <code>shmget</code> is the size of the memory you are going to allocate, and a bit flag that indicates the proper permission for process to access is set. Once the arguments have been accepted by the syscall, it returns an integer with a numeric id for your shared memory.</p>
<pre><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;sys/ipc.h&gt;
#include &lt;sys/shm.h&gt;
#include &lt;sys/types.h&gt;

#define SOMERANDOMNUMBER 1234
int main()
{
    int id;
    void* shm_addr;
    key_t key = SOMERANDOMNUMBER;
    ...
    /* 
        Here we want this shared memory to be obtainable by other programmes, hence a key identifier is used.
    */
    id = shmget(key, 4*sizeof(int), IPC_CREAT | 0666);
    if (id &lt; 0)
    {
        perror(&quot;Error while calling shmget()&quot;);
        exit(1);
    }
    ...
}
</code></pre><h3 id="shmat--shmdt"><code>shmat()</code> &amp; <code>shmdt()</code></h3>
<p><code>void *shmat(int shmid, const void *shmaddr, int shmflg);</code></p>
<p>Before we are going to use the shared memory, we must first attach the shared memory segment with the id returned by <code>shmget()</code> to the address space. This syscall function returns the address of the allocated space if it has successfully allocated the space, otherwise it returns an error number to indicate it has failed to allocated the space requested.</p>
<p>After we are done with the shared memory and would like to release them back to the Operating System, a <code>shmdt()</code> is here to serve the purpose of dettaching / disassociating the used memory space from the address that the process is holding.</p>
<pre><code>{
    ...

    shm_addr = shmat(id, NULL, 0);
    if(shm_addr == (char *) -1)
    {
        perror(&quot;Error occurred while attaching shared memory to address space&quot;);
        exit(1);
    }

    ...

    // After are done with the allocated shared memory, detach it

    if (shmdt(shm_addr) == -1) perror(&quot;Error while dettaching shared memory address&quot;);

}
</code></pre>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Inter-process Communication">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="socket.html" class="navigation navigation-next " aria-label="Next page: Unix Socket">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Shared Memory","level":"2.1.1","depth":2,"next":{"title":"Unix Socket","level":"2.1.2","depth":2,"path":"part-one/socket.md","ref":"part-one/socket.md","articles":[]},"previous":{"title":"Inter-process Communication","level":"2.1","depth":1,"path":"part-one/README.md","ref":"part-one/README.md","articles":[{"title":"Shared Memory","level":"2.1.1","depth":2,"path":"part-one/shm.md","ref":"part-one/shm.md","articles":[]},{"title":"Unix Socket","level":"2.1.2","depth":2,"path":"part-one/socket.md","ref":"part-one/socket.md","articles":[]},{"title":"Message Queue","level":"2.1.3","depth":2,"path":"part-one/msg-queue.md","ref":"part-one/msg-queue.md","articles":[]},{"title":"Memory Map","level":"2.1.4","depth":2,"path":"part-one/mmap.md","ref":"part-one/mmap.md","articles":[]},{"title":"Assignment One","level":"2.1.5","depth":2,"path":"part-one/task.md","ref":"part-one/task.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"part-one/shm.md","mtime":"2017-08-28T05:04:08.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-09-09T08:19:25.150Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>


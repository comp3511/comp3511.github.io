
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Thread Safety Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="task.html" />
    
    
    <link rel="prev" href="nitty_gritty.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Inter-process Communication</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../part-one/">
            
                <a href="../part-one/">
            
                    
                    Inter-process Communication
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="../part-one/shm.html">
            
                <a href="../part-one/shm.html">
            
                    
                    Shared Memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="../part-one/socket.html">
            
                <a href="../part-one/socket.html">
            
                    
                    Unix Socket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="../part-one/msg-queue.html">
            
                <a href="../part-one/msg-queue.html">
            
                    
                    Message Queue
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.4" data-path="../part-one/mmap.html">
            
                <a href="../part-one/mmap.html">
            
                    
                    Memory Map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="../part-one/task.html">
            
                <a href="../part-one/task.html">
            
                    
                    Assignment One
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Multithreading</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="./">
            
                <a href="./">
            
                    
                    Multithreading
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="pthread.html">
            
                <a href="pthread.html">
            
                    
                    Introduction to Pthread
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="nitty_gritty.html">
            
                <a href="nitty_gritty.html">
            
                    
                    Pthread In-depth
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.1.3" data-path="safety.html">
            
                <a href="safety.html">
            
                    
                    Thread Safety
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="task.html">
            
                <a href="task.html">
            
                    
                    Assignment Two
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Synchronization</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="../part-three/">
            
                <a href="../part-three/">
            
                    
                    Synchronization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="../part-three/mutex.html">
            
                <a href="../part-three/mutex.html">
            
                    
                    Mutex
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="../part-three/semaphore.html">
            
                <a href="../part-three/semaphore.html">
            
                    
                    Semaphore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.3" data-path="../part-three/task.html">
            
                <a href="../part-three/task.html">
            
                    
                    Assignment Three
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="divider"></li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../reference.html">
            
                <a href="../reference.html">
            
                    
                    Reference
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Thread Safety</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="introduction-to-thread-safety">Introduction to Thread Safety</h2>
<p>In the context of multi-threaded program, <strong>thread safety</strong> is achieved through meeting several conditions including:</p>
<ul>
<li><strong>Re-entrancy</strong></li>
</ul>
<p>Writing code in such a way that it can be partially executed by one task, reentered by another task, and then resumed from the original task. This requires the saving of state information in variables local to each task, usually on its stack, instead of in static or global variables.</p>
<ul>
<li><strong>Mutual exclusion</strong></li>
</ul>
<p>Access to shared data is serialized using mechanisms that ensure only one thread reads or writes the shared data at any time. Great care is required if a piece of code accesses multiple shared pieces of data&#x2014;problems include race conditions, deadlocks, livelocks, starvation, and various other ills enumerated in many operating systems textbooks.</p>
<ul>
<li><strong>Thread-local storage</strong></li>
</ul>
<p>Variables are localized so that each thread has its own private copy. These variables retain their values across subroutine and other code boundaries, and are thread-safe since they are local to each thread, even though the code which accesses them might be reentrant.</p>
<ul>
<li><strong>Atomic operations</strong></li>
</ul>
<p>Shared data are accessed by using atomic operations which cannot be interrupted by other threads. This usually requires using special machine language instructions, which might be available in a runtime library. Since the operations are atomic, the shared data are always kept in a valid state, no matter what other threads access it. Atomic operations form the basis of many thread locking mechanisms.</p>
<h3 id="race-conditions">Race Conditions</h3>
<pre><code>#include &lt;pthread.h&gt;
void* do_work(void* ptr) {
    int i = *((int *) ptr);
    printf(&quot;%d &quot;, i);
    return NULL;
}

int main() 
{
    // Each thread gets a different value of i to process
    int i;
    pthread_t tid;
    for(i =0; i &lt; 10; i++) {
        pthread_create(&amp;tid, NULL, do_work, &amp;i); // ERROR
    }
    pthread_exit(NULL);
}
</code></pre><p>The above code illustrates the problem of a race condition, the program is supposed to start ten threads with values 0 through 9, however the threads are being created while the value of i is changing, which causes the program to misbehave.</p>
<p>In the next section where we will investigate into the topic of <strong>Synchronization</strong>, we will find out how to deal with problems like this and its solutions to it.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="nitty_gritty.html" class="navigation navigation-prev " aria-label="Previous page: Pthread In-depth">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="task.html" class="navigation navigation-next " aria-label="Next page: Assignment Two">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Thread Safety","level":"3.1.3","depth":2,"next":{"title":"Assignment Two","level":"3.1.4","depth":2,"path":"part-two/task.md","ref":"part-two/task.md","articles":[]},"previous":{"title":"Pthread In-depth","level":"3.1.2","depth":2,"path":"part-two/nitty_gritty.md","ref":"part-two/nitty_gritty.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"part-two/safety.md","mtime":"2017-08-28T06:35:03.000Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2017-09-09T08:19:25.150Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

